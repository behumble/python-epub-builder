#summary This tutorial shows you how you can use this library to convert a Project Gutenburg book in 5 minutes.

= Introduction =

Being used here is the [http://code.google.com/p/python-epub-builder/source/browse/trunk/ez_epub.py simpler API], which provides the one and only function `makeBook` for real quick book generation. Of course, you can't do much with this one liner; you'll need to use the [http://code.google.com/p/python-epub-builder/source/browse/trunk/epub.py full API] for fancy things.

= Details =

Gutenburg's books are poorly structured; the transcribers use whatever text formatting rules they want. The results are books whose text cannot be reflown to small mobile device screens, and cannot be easily consumed by computer processing systems. It is unbelievable that the project creators were so short-sighted to not define and enforce a book text formatting standard (one like wiki markup language or LaTeX would suffice). In the end programmers need to suffer to clean up this mess if they want to do anything.

Enough for the complaints. [http://www.gutenberg.org/etext/1342 Pride & Prejudice] is actually not too bad. There is no indentation, and paragraphs are separated by empty lines, so I can write a short parser under 5 minutes. Each chapter (identified by a simple regular expression) corresponds to a 'section', and the paragraphs inside it are kept as a list. To detect the start and end of the book, I'll need the manual input of line numbers. Not intelligent huh? What can you expect out of a 5-minute code work?

{{{
def parseBook(path, startLineNum, endLineNum):
    PATTERN = re.compile(r'Chapter \d+$')
    sections = []
    paragraph = ''
    fin = open(path)
    lineNum = 0
    for line in fin:
        lineNum += 1
        if lineNum < startLineNum:
            continue
        if lineNum > endLineNum:
            break
        line = line.strip()
        if PATTERN.match(line):
            section = ez_epub.Section()
            section.title = line
            sections.append(section)
        elif line == '':
            if paragraph != '':
                section.paragraphs.append(paragraph)
                paragraph = ''
        else:
            paragraph += ' ' + line
    if paragraph != '':
        section.paragraphs.append(paragraph)
    return sections
}}}

Remaining is easy:
{{{
    title = 'Pride and Prejudice'
    author = 'Jane Austen'
    sections = parseBook(r'D:\epub\1342.txt', 38, 13061)
    ez_epub.makeBook(title, [author], sections, r'D:\epub\%s' % title)
}}}

End result can be downloaded [http://code.google.com/p/python-epub-builder/downloads/detail?name=Pride%20and%20Prejudice.epub&can=2&q=#makechanges here]. So you see, making EPUB is itself quite trivial, and the difficult part is to write a parser to work with unstructured text. I'd challenge you to convert this Gutenburg book [http://www.gutenberg.org/etext/132 The Art of War] to EPUB. I'd rather buy from Amazon's Kindle store(note) than to spend long hours to write heuristics for making sense out of the unruly text.

(note) Kindle does not support EPUB, but you can use [http://calibre-ebook.com/ Calibre] to convert EPUB to MOBI, which is compatible to Kindle (do you know MobiPocket was acquired by Amazon?)